#!/bin/bash

# Iterate over all directories in the current directory
for repo in */; do
  (
    cd "$repo" || exit

    # Reset the repository to the latest commit
    git reset --hard HEAD

    # Get the default branch
    default_branch=$(git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@')

    if [ -z "$default_branch" ]; then
      echo "Could not determine the default branch for $repo"
      exit
    fi

    # Checkout the default branch
    git checkout "$default_branch"

    # Temporarily adjust SSH configuration to accept new host keys
    export GIT_SSH_COMMAND='ssh -o StrictHostKeyChecking=accept-new'

    # Pull the latest changes from the checked-out branch
    git pull

    # Unset the GIT_SSH_COMMAND to restore normal behavior
    unset GIT_SSH_COMMAND
  ) &
done

wait
