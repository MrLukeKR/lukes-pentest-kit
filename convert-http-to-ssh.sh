#!/bin/bash

# Function to convert HTTP/S URL to SSH URL
convert_to_ssh() {
  local url="$1"
  local user_repo
  user_repo=$(echo "$url" | sed -E 's|https://[^/]+/|git@github.com:|; s|http://[^/]+/|git@github.com:|; s|\.git$||')
  echo "$user_repo.git"
}

# Iterate over all directories in the current directory
for repo in */; do
  (
    cd "$repo" || continue

    # Get the current origin URL
    origin_url=$(git remote get-url origin 2>/dev/null)

    # Check if the origin URL is HTTP/S
    if [[ "$origin_url" =~ ^https?:// ]]; then
      # Convert to SSH URL
      ssh_url=$(convert_to_ssh "$origin_url")

      # Set the new origin URL
      git remote set-url origin "$ssh_url"

      echo "Converted $repo from $origin_url to $ssh_url"
    fi
  ) &
done

wait
